import{r as h}from"./index-xj1BCoAc.js";import{drawGif as f}from"./Utils-DwjrTwp9.js";import{e as d}from"./NumberUtils-fSLHzFkB.js";import"./index-BtcOUWqf.js";import"./ColorUtils-Cn7nrMWp.js";import"./TypeUtils-BOyOcFPO.js";import"./Utils-B52he1Wb.js";const p=2,c=1,u=12,_=1;class A{constructor(o){this.loadImageShape=async e=>{if(!this._engine.loadImage)throw new Error(`${d} image shape not initialized`);await this._engine.loadImage({gif:e.gif,name:e.name,replaceColor:e.replaceColor??!1,src:e.src})},this._engine=o}addImage(o){this._engine.images||(this._engine.images=[]),this._engine.images.push(o)}draw(o){const{context:e,radius:s,particle:a,opacity:n}=o,i=a.image,r=i==null?void 0:i.element;if(i){if(e.globalAlpha=n,i.gif&&i.gifData)f(o);else if(r){const t=i.ratio,g={x:-s,y:-s},l=s*p;e.drawImage(r,g.x,g.y,l,l/t)}e.globalAlpha=c}}getSidesCount(){return u}async init(o){const e=o.actualOptions;if(!(!e.preload||!this._engine.loadImage))for(const s of e.preload)await this._engine.loadImage(s)}loadShape(o){if(o.shape!=="image"&&o.shape!=="images")return;this._engine.images||(this._engine.images=[]);const e=o.shapeData;if(!e)return;this._engine.images.find(a=>a.name===e.name||a.source===e.src)||this.loadImageShape(e).then(()=>{this.loadShape(o)})}particleInit(o,e){if(e.shape!=="image"&&e.shape!=="images")return;this._engine.images||(this._engine.images=[]);const s=this._engine.images,a=e.shapeData;if(!a)return;const n=e.getFillColor(),i=s.find(t=>t.name===a.name||t.source===a.src);if(!i)return;const r=a.replaceColor??i.replaceColor;if(i.loading){setTimeout(()=>{this.particleInit(o,e)});return}(async()=>{let t;i.svgData&&n?t=await h(i,a,n,e):t={color:n,data:i,element:i.element,gif:i.gif,gifData:i.gifData,gifLoopCount:i.gifLoopCount,loaded:!0,ratio:a.width&&a.height?a.width/a.height:i.ratio??_,replaceColor:r,source:a.src},t.ratio||(t.ratio=1);const g=a.fill??e.shapeFill,l=a.close??e.shapeClose,m={image:t,fill:g,close:l};e.image=m.image,e.shapeFill=m.fill,e.shapeClose=m.close})()}}export{A as ImageDrawer};
